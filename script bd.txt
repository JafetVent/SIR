CREATE TABLE usuario(
    noTrabajador INT NOT NULL,
    userName VARCHAR(20),
    nombre VARCHAR(20),
    apellido VARCHAR(20),
    rol VARCHAR(10),
    password VARCHAR(25),
    PRIMARY KEY(noTrabajador) 
); 

INSERT INTO `usuario` (`noTrabajador`, `userName`,`nombre`, `apellido`, `rol`,`password`) VALUES
(1, 'jventura', 'Jafet','Ventura', 'admin', '1234'),
(2, 'egarcia', 'Eduardo', 'Garc√≠a', 'Auditor', '12345'),
(3, 'pmarquez', 'Pedro', 'Marquez', 'Consultor', '12345');

CREATE TABLE parte(
    noParte VARCHAR(20) NOT NULL UNIQUE,
    proveedor VARCHAR(25) NOT NULL,
    subproveedor VARCHAR(25),
    descripcion VARCHAR(80) NOT NULL,
    ruta_imagen VARCHAR(100) NOT NULL,
    PRIMARY KEY(noParte) ON DELETE CASCADE
);

CREATE TABLE factura(
    idInvoice INT NOT NULL,
    ruta_factura VARCHAR(100),
    fecha DATE,
    PRIMARY KEY(idInvoice) ON DELETE CASCADE
); 


CREATE TABLE facturas_parte(
    idFacPar INT NOT NULL AUTO_INCREMENT,
    idInvoice INT NOT NULL,
    noParte VARCHAR(20) NOT NULL,
    PRIMARY KEY(idFacPar),
    FOREIGN KEY(idInvoice) REFERENCES factura(idInvoice) ON DELETE CASCADE,
    FOREIGN KEY(noParte) REFERENCES parte(noParte) ON DELETE CASCADE
);
CREATE UNIQUE INDEX factura_partes ON facturas_parte(idInvoice, noParte);


CREATE TABLE valoresinsp(
    idValor INT NOT NULL AUTO_INCREMENT,
    noParte VARCHAR(20) NOT NULL,
    caracteristicas VARCHAR(80) NOT NULL,
    especificacion VARCHAR(80) NOT NULL,
    equipo VARCHAR(80) NOT NULL,
    toleranciamin VARCHAR(5) NOT NULL,
    toleranciamax VARCHAR(5) NOT NULL,
    PRIMARY KEY(idValor) ON DELETE CASCADE,
    FOREIGN KEY(noParte) REFERENCES parte(noParte)
);
CREATE UNIQUE INDEX valoresinspc ON valoresinsp(noParte, caracteristicas, especificacion, equipo, toleranciamin, toleranciamax);

CREATE TABLE reporte(
    idReporte INT NOT NULL AUTO_INCREMENT,
    idFacPar INT,
    noTrabajador INT,
    fecha DATE,
    fechafifo DATE,
    noCaja VARCHAR(25),
    turno VARCHAR(1),
    estatus VARCHAR(2),
    observacion VARCHAR(60),
    PRIMARY KEY(idReporte) ON DELETE CASCADE,
    FOREIGN KEY(idFacPar) REFERENCES facturas_parte(idFacPar) ON DELETE CASCADE,
    FOREIGN KEY(noTrabajador) REFERENCES usuario(noTrabajador)
);

CREATE TABLE inspecciones(
    idInspeccion INT NOT NULL AUTO_INCREMENT,
    idReporte INT NOT NULL,
    i1 VARCHAR(80) NOT NULL,
    i2 VARCHAR(80) NOT NULL,
    i3 VARCHAR(80) NOT NULL,
    i4 VARCHAR(80) NOT NULL,
    i5 VARCHAR(80) NOT NULL,
    PRIMARY KEY(idInspeccion) ON DELETE CASCADE,
    FOREIGN KEY(idReporte) REFERENCES reporte(idReporte)
);
CREATE UNIQUE INDEX inspeccion ON inspecciones(idInspeccion, idReporte);


DELIMITER ;

DELIMITER $$
CREATE TRIGGER prueba AFTER INSERT ON facturas_parte FOR EACH ROW 
BEGIN
  INSERT INTO reporte (idFacPar)
  VALUES (new.idFacPar);
END $$
DELIMITER ;
